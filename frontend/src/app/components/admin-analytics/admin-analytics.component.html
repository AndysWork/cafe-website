<div class="admin-analytics-container">
  <div class="page-header">
    <h1>ğŸ“ˆ Analytics Dashboard</h1>

    <!-- Analytics Tab Switcher -->
    <div class="analytics-tabs">
      <button
        class="tab-btn"
        [class.active]="selectedAnalyticsTab === 'sales'"
        (click)="switchTab('sales')">
        ğŸ’° Sales Analytics
      </button>
      <button
        class="tab-btn"
        [class.active]="selectedAnalyticsTab === 'expenses'"
        (click)="switchTab('expenses')">
        ğŸ’¸ Expense Analytics
      </button>
      <button
        class="tab-btn"
        [class.active]="selectedAnalyticsTab === 'earnings'"
        (click)="switchTab('earnings')">
        ğŸ’µ Earnings Analytics
      </button>
    </div>

    <div class="date-filter">
      <label>From:</label>
      <input type="date" [(ngModel)]="dateRange.startDate" (change)="onDateRangeChange()">
      <label>To:</label>
      <input type="date" [(ngModel)]="dateRange.endDate" (change)="onDateRangeChange()">
    </div>
  </div>

  <!-- Sales Analytics Section -->
  <div *ngIf="selectedAnalyticsTab === 'sales'">
    <h2 class="section-title">ğŸ’° Sales Analytics</h2>

  <div *ngIf="loading" class="loading">
    <p>Loading insights...</p>
  </div>

  <div *ngIf="!loading && !insights" class="empty-state">
    <p>No sales data available for the selected date range</p>
  </div>

  <div *ngIf="!loading && insights" class="insights-container">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card revenue">
        <div class="card-icon">ğŸ’°</div>
        <div class="card-content">
          <h3>Total Revenue</h3>
          <p class="card-value">{{ formatCurrency(insights.totalRevenue) }}</p>
          <span class="card-subtext">{{ insights.totalTransactions }} transactions</span>
        </div>
      </div>

      <div class="summary-card average">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-content">
          <h3>Avg Transaction</h3>
          <p class="card-value">{{ formatCurrency(insights.averageTransaction) }}</p>
          <span class="card-subtext">Per order</span>
        </div>
      </div>

      <div class="summary-card daily">
        <div class="card-icon">ğŸ“…</div>
        <div class="card-content">
          <h3>Daily Average</h3>
          <p class="card-value">{{ formatCurrency(insights.dailyAverage) }}</p>
          <span class="card-subtext">Per day</span>
        </div>
      </div>

      <div class="summary-card growth">
        <div class="card-icon">{{ insights.growthRate >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰' }}</div>
        <div class="card-content">
          <h3>Growth Rate</h3>
          <p class="card-value" [class.positive]="insights.growthRate >= 0" [class.negative]="insights.growthRate < 0">
            {{ formatPercentage(insights.growthRate) }}
          </p>
          <span class="card-subtext">Period comparison</span>
        </div>
      </div>
    </div>

    <!-- Top Selling Items -->
    <div class="insight-section">
      <h2>ğŸ† Top Selling Items</h2>
      <div class="top-items-grid">
        <div *ngFor="let item of insights.topSellingItems; let i = index" class="top-item-card" [class.top-1]="i === 0" [class.top-2]="i === 1" [class.top-3]="i === 2">
          <div class="item-rank">{{ i + 1 }}</div>
          <div class="item-details">
            <h4>{{ item.name }}</h4>
            <p>Quantity: {{ item.quantity }}</p>
            <p class="item-revenue">{{ formatCurrency(item.revenue) }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Method Breakdown -->
    <div class="insight-section">
      <h2>ğŸ’³ Payment Method Breakdown</h2>
      <div class="payment-breakdown">
        <div *ngFor="let payment of insights.paymentMethodBreakdown" class="payment-card">
          <div class="payment-header">
            <h3>{{ payment.method }}</h3>
            <span class="payment-count">{{ payment.count }} transactions</span>
          </div>
          <div class="payment-amount">{{ formatCurrency(payment.total) }}</div>
          <div class="payment-bar">
            <div class="payment-bar-fill" [style.width.%]="(payment.total / insights.totalRevenue) * 100"></div>
          </div>
          <span class="payment-percentage">{{ ((payment.total / insights.totalRevenue) * 100).toFixed(1) }}% of total</span>
        </div>
      </div>
    </div>

    <!-- Category Breakdown -->
    <div class="insight-section">
      <h2>ğŸ½ï¸ Sales by Category</h2>
      <div class="category-breakdown">
        <div *ngFor="let category of insights.itemCategoryBreakdown" class="category-card">
          <div class="category-icon">{{ getCategoryIcon(category.category) }}</div>
          <div class="category-details">
            <h3>{{ category.category }}</h3>
            <p>{{ category.count }} items sold</p>
            <p class="category-revenue">{{ formatCurrency(category.revenue) }}</p>
          </div>
          <div class="category-percentage">
            {{ ((category.revenue / insights.totalRevenue) * 100).toFixed(1) }}%
          </div>
        </div>
      </div>
    </div>

    <!-- Weekly Trend -->
    <div class="insight-section">
      <h2>ğŸ“Š Weekly Trend (Last 4 Weeks)</h2>
      <div class="trend-chart">
        <div *ngFor="let week of insights.weeklyTrend" class="trend-bar-container">
          <div class="trend-bar" [style.height.%]="(week.total / getMaxWeeklyTotal()) * 100">
            <span class="trend-value">{{ formatCurrency(week.total) }}</span>
          </div>
          <span class="trend-label">{{ week.week }}</span>
        </div>
      </div>
    </div>

    <!-- Monthly Comparison -->
    <div class="insight-section">
      <h2>ğŸ“ˆ Monthly Comparison (Last 6 Months)</h2>
      <div class="monthly-chart">
        <div *ngFor="let month of insights.monthlyComparison" class="monthly-bar-container">
          <div class="monthly-bar" [style.height.%]="(month.total / getMaxMonthlyTotal()) * 100">
            <span class="monthly-value">{{ formatCurrency(month.total) }}</span>
            <span class="monthly-transactions">{{ month.transactions }} orders</span>
          </div>
          <span class="monthly-label">{{ month.month }}</span>
        </div>
      </div>
    </div>

    <!-- Peak Sales Days -->
    <div class="insight-section">
      <h2>ğŸ”¥ Top 5 Peak Sales Days</h2>
      <div class="peak-days-list">
        <div *ngFor="let day of insights.peakSalesDays; let i = index" class="peak-day-card">
          <div class="peak-rank">{{ i + 1 }}</div>
          <div class="peak-date">{{ day.day }}</div>
          <div class="peak-amount">{{ formatCurrency(day.total) }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Expense Analytics Section -->
  <div *ngIf="selectedAnalyticsTab === 'expenses'" class="expense-analytics-section">
    <div class="section-header">
      <h2 class="section-title">ğŸ’¸ Expense Analytics</h2>

      <!-- Expense Source Filter -->
      <div class="expense-source-filter">
        <button
          class="filter-btn"
          [class.active]="expenseSource === 'All'"
          (click)="switchExpenseSource('All')">
          ğŸŒ All Expenses
        </button>
        <button
          class="filter-btn"
          [class.active]="expenseSource === 'Offline'"
          (click)="switchExpenseSource('Offline')">
          ğŸª Offline
        </button>
        <button
          class="filter-btn"
          [class.active]="expenseSource === 'Online'"
          (click)="switchExpenseSource('Online')">
          ğŸŒ Online
        </button>
      </div>
    </div>

    <div *ngIf="expenseLoading" class="loading">
      <p>Loading expense analytics...</p>
    </div>

    <div *ngIf="!expenseLoading && !expenseAnalytics" class="empty-state">
      <p>No expense data available for the selected date range</p>
    </div>

    <div *ngIf="!expenseLoading && expenseAnalytics" class="insights-container">
      <!-- Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card expense-total">
          <div class="card-icon">ğŸ’¸</div>
          <div class="card-content">
            <h3>Total Expenses</h3>
            <p class="card-value">{{ formatCurrency(expenseAnalytics.summary.totalExpenses) }}</p>
            <span class="card-subtext">{{ expenseAnalytics.summary.expenseCount }} transactions</span>
          </div>
        </div>

        <div class="summary-card average-expense">
          <div class="card-icon">ğŸ“Š</div>
          <div class="card-content">
            <h3>Avg Expense</h3>
            <p class="card-value">{{ formatCurrency(expenseAnalytics.summary.averageExpense) }}</p>
            <span class="card-subtext">Per transaction</span>
          </div>
        </div>

        <div class="summary-card daily-expense">
          <div class="card-icon">ğŸ“…</div>
          <div class="card-content">
            <h3>Daily Average</h3>
            <p class="card-value">{{ formatCurrency(expenseAnalytics.summary.dailyAverage) }}</p>
            <span class="card-subtext">Per day</span>
          </div>
        </div>

        <div class="summary-card growth-rate">
          <div class="card-icon">{{ expenseAnalytics.summary.growthRate >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰' }}</div>
          <div class="card-content">
            <h3>Growth Rate</h3>
            <p class="card-value" [class.positive]="expenseAnalytics.summary.growthRate >= 0" [class.negative]="expenseAnalytics.summary.growthRate < 0">
              {{ formatPercentage(expenseAnalytics.summary.growthRate) }}
            </p>
            <span class="card-subtext">Period comparison</span>
          </div>
        </div>
      </div>

      <!-- Top Expense Types -->
      <div class="insight-section">
        <h2>ğŸ† Top Expense Categories</h2>
        <div class="top-items-grid">
          <div *ngFor="let item of expenseAnalytics.topExpenseTypes; let i = index"
               class="top-item-card"
               [class.top-1]="i === 0"
               [class.top-2]="i === 1"
               [class.top-3]="i === 2">
            <div class="item-rank">{{ i + 1 }}</div>
            <div class="item-details">
              <h4>{{ getExpenseTypeIcon(item.expenseType) }} {{ item.expenseType }}</h4>
              <p>Count: {{ item.count }} ({{ item.percentage.toFixed(1) }}%)</p>
              <p>Avg: {{ formatCurrency(item.averageAmount) }}</p>
              <p class="item-revenue">{{ formatCurrency(item.totalAmount) }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Source Breakdown (if All) -->
      <div *ngIf="expenseSource === 'All' && expenseAnalytics.sourceBreakdown.length > 0" class="insight-section">
        <h2>ğŸ“ Expense Source Breakdown</h2>
        <div class="payment-breakdown">
          <div *ngFor="let source of expenseAnalytics.sourceBreakdown" class="payment-card">
            <div class="payment-header">
              <h3>{{ source.source === 'Offline' ? 'ğŸª' : 'ğŸŒ' }} {{ source.source }}</h3>
              <span class="payment-count">{{ source.count }} expenses</span>
            </div>
            <div class="payment-amount">{{ formatCurrency(source.totalAmount) }}</div>
            <div class="payment-bar">
              <div class="payment-bar-fill" [style.width.%]="source.percentage"></div>
            </div>
            <span class="payment-percentage">{{ source.percentage.toFixed(1) }}% of total</span>
          </div>
        </div>
      </div>

      <!-- Payment Method Breakdown -->
      <div class="insight-section">
        <h2>ğŸ’³ Payment Method Breakdown</h2>
        <div class="payment-breakdown">
          <div *ngFor="let payment of expenseAnalytics.paymentMethodBreakdown" class="payment-card">
            <div class="payment-header">
              <h3>{{ payment.paymentMethod }}</h3>
              <span class="payment-count">{{ payment.count }} transactions</span>
            </div>
            <div class="payment-amount">{{ formatCurrency(payment.totalAmount) }}</div>
            <div class="payment-bar">
              <div class="payment-bar-fill" [style.width.%]="payment.percentage"></div>
            </div>
            <span class="payment-percentage">{{ payment.percentage.toFixed(1) }}% of total</span>
          </div>
        </div>
      </div>

      <!-- Weekly Trend -->
      <div class="insight-section">
        <h2>ğŸ“Š Weekly Expense Trend</h2>
        <div class="trend-chart">
          <div *ngFor="let week of expenseAnalytics.weeklyTrend" class="trend-bar-container">
            <div class="trend-bar" [style.height.%]="(week.totalAmount / getMaxExpenseWeekly()) * 100">
              <span class="trend-value">{{ formatCurrency(week.totalAmount) }}</span>
            </div>
            <span class="trend-label">{{ week.weekStart }}</span>
          </div>
        </div>
      </div>

      <!-- Monthly Comparison -->
      <div class="insight-section">
        <h2>ğŸ“ˆ Monthly Expense Comparison</h2>
        <div class="monthly-chart">
          <div *ngFor="let month of expenseAnalytics.monthlyComparison" class="monthly-bar-container">
            <div class="monthly-bar" [style.height.%]="(month.totalAmount / getMaxExpenseMonthly()) * 100">
              <span class="monthly-value">{{ formatCurrency(month.totalAmount) }}</span>
              <span class="monthly-transactions">{{ month.count }} expenses</span>
            </div>
            <span class="monthly-label">{{ month.monthName }}</span>
          </div>
        </div>
      </div>

      <!-- Peak Expense Days -->
      <div class="insight-section">
        <h2>ğŸ”¥ Top 10 Highest Expense Days</h2>
        <div class="peak-days-list">
          <div *ngFor="let day of expenseAnalytics.peakExpenseDays; let i = index" class="peak-day-card">
            <div class="peak-rank">{{ i + 1 }}</div>
            <div class="peak-date">{{ day.date }}</div>
            <div class="peak-count">{{ day.count }} expenses</div>
            <div class="peak-amount">{{ formatCurrency(day.totalAmount) }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Earnings Analytics Section -->
  <div *ngIf="selectedAnalyticsTab === 'earnings'">
    <h2 class="section-title">ğŸ’µ Earnings Analytics</h2>

    <div *ngIf="earningsLoading" class="loading">
      <p>Loading earnings data...</p>
    </div>

    <div *ngIf="!earningsLoading && !earningsData" class="empty-state">
      <p>No earnings data available for the selected date range</p>
    </div>

    <div *ngIf="!earningsLoading && earningsData" class="insights-container">
      <!-- Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card revenue">
          <div class="card-icon">ğŸ’°</div>
          <div class="card-content">
            <h3>Total Offline Sales</h3>
            <p class="card-value">{{ formatCurrency(earningsData.totalSales) }}</p>
            <span class="card-subtext">All sales</span>
          </div>
        </div>

        <div class="summary-card expense-total">
          <div class="card-icon">ğŸ’¸</div>
          <div class="card-content">
            <h3>Total Offline Expenses</h3>
            <p class="card-value">{{ formatCurrency(earningsData.offlineExpenses) }}</p>
            <span class="card-subtext">Cash expenses</span>
          </div>
        </div>

        <div class="summary-card expense-total">
          <div class="card-icon">ğŸ’³</div>
          <div class="card-content">
            <h3>Total Online Expenses</h3>
            <p class="card-value">{{ formatCurrency(earningsData.onlineExpenses) }}</p>
            <span class="card-subtext">Card/Online expenses</span>
          </div>
        </div>

        <div class="summary-card cash-collection">
          <div class="card-icon">ğŸ’µ</div>
          <div class="card-content">
            <h3>Total Cash Collection</h3>
            <p class="card-value">{{ formatCurrency(earningsData.totalCashCollection) }}</p>
            <span class="card-subtext">Cash sales</span>
          </div>
        </div>

        <div class="summary-card online-collection">
          <div class="card-icon">ğŸŒ</div>
          <div class="card-content">
            <h3>Total Online Collection</h3>
            <p class="card-value">{{ formatCurrency(earningsData.totalOnlineCollection) }}</p>
            <span class="card-subtext">Online sales</span>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>
