<div class="admin-analytics-container">
  <div class="page-header">
    <h1>ğŸ“ˆ Analytics Dashboard</h1>

    <!-- Analytics Tab Switcher -->
    <div class="analytics-tabs">
      <button
        class="tab-btn"
        [class.active]="selectedAnalyticsTab === 'sales'"
        (click)="switchTab('sales')">
        ğŸ’° Offline Sales Analytics
      </button>
      <button
        class="tab-btn"
        [class.active]="selectedAnalyticsTab === 'online'"
        (click)="switchTab('online')">
        ğŸ“± Online Sales Analytics
      </button>
      <button
        class="tab-btn"
        [class.active]="selectedAnalyticsTab === 'expenses'"
        (click)="switchTab('expenses')">
        ğŸ’¸ Expense Analytics
      </button>
      <button
        class="tab-btn"
        [class.active]="selectedAnalyticsTab === 'earnings'"
        (click)="switchTab('earnings')">
        ğŸ’µ Earnings Analytics
      </button>
    </div>

    <div class="date-filter">
      <label>From:</label>
      <input type="date" [(ngModel)]="dateRange.startDate" (change)="onDateRangeChange()">
      <label>To:</label>
      <input type="date" [(ngModel)]="dateRange.endDate" (change)="onDateRangeChange()">
    </div>
  </div>

  <!-- Sales Analytics Section -->
  <div *ngIf="selectedAnalyticsTab === 'sales'">
    <h2 class="section-title">ğŸ’° Sales Analytics</h2>

  <div *ngIf="loading" class="loading">
    <p>Loading insights...</p>
  </div>

  <div *ngIf="!loading && !insights" class="empty-state">
    <p>No sales data available for the selected date range</p>
  </div>

  <div *ngIf="!loading && insights" class="insights-container">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card revenue">
        <div class="card-icon">ğŸ’°</div>
        <div class="card-content">
          <h3>Total Revenue</h3>
          <p class="card-value">{{ formatCurrency(insights.totalRevenue) }}</p>
          <span class="card-subtext">{{ insights.totalTransactions }} transactions</span>
        </div>
      </div>

      <div class="summary-card average">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-content">
          <h3>Avg Transaction</h3>
          <p class="card-value">{{ formatCurrency(insights.averageTransaction) }}</p>
          <span class="card-subtext">Per order</span>
        </div>
      </div>

      <div class="summary-card daily">
        <div class="card-icon">ğŸ“…</div>
        <div class="card-content">
          <h3>Daily Average</h3>
          <p class="card-value">{{ formatCurrency(insights.dailyAverage) }}</p>
          <span class="card-subtext">Per day</span>
        </div>
      </div>

      <div class="summary-card growth">
        <div class="card-icon">{{ insights.growthRate >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰' }}</div>
        <div class="card-content">
          <h3>Growth Rate</h3>
          <p class="card-value" [class.positive]="insights.growthRate >= 0" [class.negative]="insights.growthRate < 0">
            {{ formatPercentage(insights.growthRate) }}
          </p>
          <span class="card-subtext">Period comparison</span>
        </div>
      </div>
    </div>

    <!-- Top Selling Items -->
    <div class="insight-section">
      <h2>ğŸ† Top Selling Items</h2>
      <div class="top-items-grid">
        <div *ngFor="let item of insights.topSellingItems; let i = index" class="top-item-card" [class.top-1]="i === 0" [class.top-2]="i === 1" [class.top-3]="i === 2">
          <div class="item-rank">{{ i + 1 }}</div>
          <div class="item-details">
            <h4>{{ item.name }}</h4>
            <p>Quantity: {{ item.quantity }}</p>
            <p class="item-revenue">{{ formatCurrency(item.revenue) }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Method Breakdown -->
    <div class="insight-section">
      <h2>ğŸ’³ Payment Method Breakdown</h2>
      <div class="payment-breakdown">
        <div *ngFor="let payment of insights.paymentMethodBreakdown" class="payment-card">
          <div class="payment-header">
            <h3>{{ payment.method }}</h3>
            <span class="payment-count">{{ payment.count }} transactions</span>
          </div>
          <div class="payment-amount">{{ formatCurrency(payment.total) }}</div>
          <div class="payment-bar">
            <div class="payment-bar-fill" [style.width.%]="(payment.total / insights.totalRevenue) * 100"></div>
          </div>
          <span class="payment-percentage">{{ ((payment.total / insights.totalRevenue) * 100).toFixed(1) }}% of total</span>
        </div>
      </div>
    </div>

    <!-- Category Breakdown -->
    <div class="insight-section">
      <h2>ğŸ½ï¸ Sales by Category</h2>
      <div class="category-breakdown">
        <div *ngFor="let category of insights.itemCategoryBreakdown" class="category-card">
          <div class="category-icon">{{ getCategoryIcon(category.category) }}</div>
          <div class="category-details">
            <h3>{{ category.category }}</h3>
            <p>{{ category.count }} items sold</p>
            <p class="category-revenue">{{ formatCurrency(category.revenue) }}</p>
          </div>
          <div class="category-percentage">
            {{ ((category.revenue / insights.totalRevenue) * 100).toFixed(1) }}%
          </div>
        </div>
      </div>
    </div>

    <!-- Weekly Trend -->
    <div class="insight-section">
      <h2>ğŸ“Š Weekly Trend (Last 4 Weeks)</h2>
      <div class="trend-chart">
        <div *ngFor="let week of insights.weeklyTrend" class="trend-bar-container">
          <div class="trend-bar" [style.height.%]="(week.total / getMaxWeeklyTotal()) * 100">
            <span class="trend-value">{{ formatCurrency(week.total) }}</span>
          </div>
          <span class="trend-label">{{ week.week }}</span>
        </div>
      </div>
    </div>

    <!-- Monthly Comparison -->
    <div class="insight-section">
      <h2>ğŸ“ˆ Monthly Comparison (Last 6 Months)</h2>
      <div class="monthly-chart">
        <div *ngFor="let month of insights.monthlyComparison" class="monthly-bar-container">
          <div class="monthly-bar" [style.height.%]="(month.total / getMaxMonthlyTotal()) * 100">
            <span class="monthly-value">{{ formatCurrency(month.total) }}</span>
            <span class="monthly-transactions">{{ month.transactions }} orders</span>
          </div>
          <span class="monthly-label">{{ month.month }}</span>
        </div>
      </div>
    </div>

    <!-- Peak Sales Days -->
    <div class="insight-section">
      <h2>ğŸ”¥ Top 5 Peak Sales Days</h2>
      <div class="peak-days-list">
        <div *ngFor="let day of insights.peakSalesDays; let i = index" class="peak-day-card">
          <div class="peak-rank">{{ i + 1 }}</div>
          <div class="peak-date">{{ day.day }}</div>
          <div class="peak-amount">{{ formatCurrency(day.total) }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Expense Analytics Section -->
  <div *ngIf="selectedAnalyticsTab === 'expenses'" class="expense-analytics-section">
    <div class="section-header">
      <h2 class="section-title">ğŸ’¸ Expense Analytics</h2>

      <!-- Expense Source Filter -->
      <div class="expense-source-filter">
        <button
          class="filter-btn"
          [class.active]="expenseSource === 'All'"
          (click)="switchExpenseSource('All')">
          ğŸŒ All Expenses
        </button>
        <button
          class="filter-btn"
          [class.active]="expenseSource === 'Offline'"
          (click)="switchExpenseSource('Offline')">
          ğŸª Offline
        </button>
        <button
          class="filter-btn"
          [class.active]="expenseSource === 'Online'"
          (click)="switchExpenseSource('Online')">
          ğŸŒ Online
        </button>
      </div>
    </div>

    <div *ngIf="expenseLoading" class="loading">
      <p>Loading expense analytics...</p>
    </div>

    <div *ngIf="!expenseLoading && !expenseAnalytics" class="empty-state">
      <p>No expense data available for the selected date range</p>
    </div>

    <div *ngIf="!expenseLoading && expenseAnalytics" class="insights-container">
      <!-- Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card expense-total">
          <div class="card-icon">ğŸ’¸</div>
          <div class="card-content">
            <h3>Total Expenses</h3>
            <p class="card-value">{{ formatCurrency(expenseAnalytics.summary.totalExpenses) }}</p>
            <span class="card-subtext">{{ expenseAnalytics.summary.expenseCount }} transactions</span>
          </div>
        </div>

        <div class="summary-card average-expense">
          <div class="card-icon">ğŸ“Š</div>
          <div class="card-content">
            <h3>Avg Expense</h3>
            <p class="card-value">{{ formatCurrency(expenseAnalytics.summary.averageExpense) }}</p>
            <span class="card-subtext">Per transaction</span>
          </div>
        </div>

        <div class="summary-card daily-expense">
          <div class="card-icon">ğŸ“…</div>
          <div class="card-content">
            <h3>Daily Average</h3>
            <p class="card-value">{{ formatCurrency(expenseAnalytics.summary.dailyAverage) }}</p>
            <span class="card-subtext">Per day</span>
          </div>
        </div>

        <div class="summary-card growth-rate">
          <div class="card-icon">{{ expenseAnalytics.summary.growthRate >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰' }}</div>
          <div class="card-content">
            <h3>Growth Rate</h3>
            <p class="card-value" [class.positive]="expenseAnalytics.summary.growthRate >= 0" [class.negative]="expenseAnalytics.summary.growthRate < 0">
              {{ formatPercentage(expenseAnalytics.summary.growthRate) }}
            </p>
            <span class="card-subtext">Period comparison</span>
          </div>
        </div>
      </div>

      <!-- Top Expense Types -->
      <div class="insight-section">
        <h2>ğŸ† Top Expense Categories</h2>
        <div class="top-items-grid">
          <div *ngFor="let item of expenseAnalytics.topExpenseTypes; let i = index"
               class="top-item-card"
               [class.top-1]="i === 0"
               [class.top-2]="i === 1"
               [class.top-3]="i === 2">
            <div class="item-rank">{{ i + 1 }}</div>
            <div class="item-details">
              <h4>{{ getExpenseTypeIcon(item.expenseType) }} {{ item.expenseType }}</h4>
              <p>Count: {{ item.count }} ({{ item.percentage.toFixed(1) }}%)</p>
              <p>Avg: {{ formatCurrency(item.averageAmount) }}</p>
              <p class="item-revenue">{{ formatCurrency(item.totalAmount) }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Source Breakdown (if All) -->
      <div *ngIf="expenseSource === 'All' && expenseAnalytics.sourceBreakdown.length > 0" class="insight-section">
        <h2>ğŸ“ Expense Source Breakdown</h2>
        <div class="payment-breakdown">
          <div *ngFor="let source of expenseAnalytics.sourceBreakdown" class="payment-card">
            <div class="payment-header">
              <h3>{{ source.source === 'Offline' ? 'ğŸª' : 'ğŸŒ' }} {{ source.source }}</h3>
              <span class="payment-count">{{ source.count }} expenses</span>
            </div>
            <div class="payment-amount">{{ formatCurrency(source.totalAmount) }}</div>
            <div class="payment-bar">
              <div class="payment-bar-fill" [style.width.%]="source.percentage"></div>
            </div>
            <span class="payment-percentage">{{ source.percentage.toFixed(1) }}% of total</span>
          </div>
        </div>
      </div>

      <!-- Payment Method Breakdown -->
      <div class="insight-section">
        <h2>ğŸ’³ Payment Method Breakdown</h2>
        <div class="payment-breakdown">
          <div *ngFor="let payment of expenseAnalytics.paymentMethodBreakdown" class="payment-card">
            <div class="payment-header">
              <h3>{{ payment.paymentMethod }}</h3>
              <span class="payment-count">{{ payment.count }} transactions</span>
            </div>
            <div class="payment-amount">{{ formatCurrency(payment.totalAmount) }}</div>
            <div class="payment-bar">
              <div class="payment-bar-fill" [style.width.%]="payment.percentage"></div>
            </div>
            <span class="payment-percentage">{{ payment.percentage.toFixed(1) }}% of total</span>
          </div>
        </div>
      </div>

      <!-- Weekly Trend -->
      <div class="insight-section">
        <h2>ğŸ“Š Weekly Expense Trend</h2>
        <div class="trend-chart">
          <div *ngFor="let week of expenseAnalytics.weeklyTrend" class="trend-bar-container">
            <div class="trend-bar" [style.height.%]="(week.totalAmount / getMaxExpenseWeekly()) * 100">
              <span class="trend-value">{{ formatCurrency(week.totalAmount) }}</span>
            </div>
            <span class="trend-label">{{ week.weekStart }}</span>
          </div>
        </div>
      </div>

      <!-- Monthly Comparison -->
      <div class="insight-section">
        <h2>ğŸ“ˆ Monthly Expense Comparison</h2>
        <div class="monthly-chart">
          <div *ngFor="let month of expenseAnalytics.monthlyComparison" class="monthly-bar-container">
            <div class="monthly-bar" [style.height.%]="(month.totalAmount / getMaxExpenseMonthly()) * 100">
              <span class="monthly-value">{{ formatCurrency(month.totalAmount) }}</span>
              <span class="monthly-transactions">{{ month.count }} expenses</span>
            </div>
            <span class="monthly-label">{{ month.monthName }}</span>
          </div>
        </div>
      </div>

      <!-- Peak Expense Days -->
      <div class="insight-section">
        <h2>ğŸ”¥ Top 10 Highest Expense Days</h2>
        <div class="peak-days-list">
          <div *ngFor="let day of expenseAnalytics.peakExpenseDays; let i = index" class="peak-day-card">
            <div class="peak-rank">{{ i + 1 }}</div>
            <div class="peak-date">{{ day.date }}</div>
            <div class="peak-count">{{ day.count }} expenses</div>
            <div class="peak-amount">{{ formatCurrency(day.totalAmount) }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Earnings Analytics Section -->
  <div *ngIf="selectedAnalyticsTab === 'earnings'">
    <h2 class="section-title">ğŸ’µ Earnings & PnL Analytics</h2>

    <div *ngIf="earningsLoading" class="loading">
      <p>Loading earnings data...</p>
    </div>

    <ng-container *ngIf="!earningsLoading && earningsData">

      <div class="insights-container">

      <!-- PnL Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card total-revenue">
          <div class="card-icon">ğŸ“Š</div>
          <div class="card-content">
            <h3 style="color: #666 !important;">Total Revenue</h3>
            <p class="card-value" style="color: #333 !important;">{{ formatCurrency(earningsData?.totalRevenue || 0) }}</p>
            <span class="card-subtext" style="color: #999 !important;">Offline + Online Sales</span>
          </div>
        </div>

        <div class="summary-card total-expenses">
          <div class="card-icon">ğŸ’¸</div>
          <div class="card-content">
            <h3 style="color: #666 !important;">Total Expenses</h3>
            <p class="card-value" style="color: #333 !important;">{{ formatCurrency(earningsData?.totalExpenses || 0) }}</p>
            <span class="card-subtext" style="color: #999 !important;">All expenses</span>
          </div>
        </div>

        <div class="summary-card" [class.net-profit]="(earningsData?.netProfitLoss || 0) >= 0" [class.net-loss]="(earningsData?.netProfitLoss || 0) < 0">
          <div class="card-icon">{{ (earningsData?.netProfitLoss || 0) >= 0 ? 'âœ…' : 'âš ï¸' }}</div>
          <div class="card-content">
            <h3 style="color: #666 !important;">{{ (earningsData?.netProfitLoss || 0) >= 0 ? 'Net Profit' : 'Net Loss' }}</h3>
            <p class="card-value" style="color: #333 !important;">{{ formatCurrency(Math.abs(earningsData?.netProfitLoss || 0)) }}</p>
            <span class="card-subtext" style="color: #999 !important;">Revenue - Expenses</span>
          </div>
        </div>

        <div class="summary-card profit-margin">
          <div class="card-icon">ğŸ“ˆ</div>
          <div class="card-content">
            <h3 style="color: #666 !important;">Profit Margin</h3>
            <p class="card-value" style="color: #333 !important;">{{ (earningsData?.profitMargin || 0).toFixed(2) }}%</p>
            <span class="card-subtext" style="color: #999 !important;">{{ (earningsData?.profitMargin || 0) >= 0 ? 'Positive' : 'Negative' }} margin</span>
          </div>
        </div>
      </div>

      <!-- Revenue Breakdown -->
      <div class="insight-section">
        <h3>ğŸ’° Revenue Breakdown</h3>
        <div class="revenue-breakdown">
          <div class="breakdown-card">
            <h4>ğŸª Offline Store Sales</h4>
            <p class="amount">{{ formatCurrency(earningsData?.totalOfflineSales || 0) }}</p>
            <div class="breakdown-details">
              <span>ğŸ’µ Cash: {{ formatCurrency(earningsData?.totalCashSales || 0) }}</span>
              <span>ğŸ’³ Online: {{ formatCurrency(earningsData?.totalOnlineSalesPayment || 0) }}</span>
            </div>
          </div>

          <div class="breakdown-card online-platform">
            <h4>ğŸ“± Online Platforms</h4>
            <p class="amount">{{ formatCurrency(earningsData?.zomatoSwiggyIncome || 0) }}</p>
            <div class="breakdown-details">
              <span>ğŸ” Zomato: {{ formatCurrency(earningsData?.zomatoIncome || 0) }}</span>
              <span>ğŸ• Swiggy: {{ formatCurrency(earningsData?.swiggyIncome || 0) }}</span>
              <span class="orders-count">{{ earningsData?.zomatoSwiggyOrders || 0 }} orders</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Online Platform Details -->
      <div class="insight-section" *ngIf="(earningsData?.zomatoSwiggyOrders || 0) > 0">
        <h3>ğŸ“± Online Platform Analysis</h3>
        <div class="platform-details">
          <div class="detail-card">
            <span class="label">Platform Income (Payout)</span>
            <span class="value income-amount">{{ formatCurrency(earningsData?.zomatoSwiggyIncome || 0) }}</span>
          </div>
          <div class="detail-card">
            <span class="label">Platform Deductions</span>
            <span class="value deduction-amount">{{ formatCurrency(earningsData?.zomatoSwiggyDeductions || 0) }}</span>
          </div>
          <div class="detail-card">
            <span class="label">Customer Discounts</span>
            <span class="value discount-amount">{{ formatCurrency(earningsData?.zomatoSwiggyDiscount || 0) }}</span>
          </div>
          <div class="detail-card">
            <span class="label">Packaging Charges</span>
            <span class="value packaging-amount">{{ formatCurrency(earningsData?.zomatoSwiggyPackaging || 0) }}</span>
          </div>
        </div>
      </div>

      <!-- Expense Breakdown -->
      <div class="insight-section">
        <h3>ğŸ’¸ Expense Breakdown</h3>
        <div class="expense-breakdown">
          <div class="breakdown-card">
            <h4>ğŸ’µ Cash Expenses</h4>
            <p class="amount expense">{{ formatCurrency(earningsData?.offlineExpenses || 0) }}</p>
          </div>

          <div class="breakdown-card">
            <h4>ğŸ’³ Online Expenses</h4>
            <p class="amount expense">{{ formatCurrency(earningsData?.onlineExpenses || 0) }}</p>
          </div>

          <div class="breakdown-card" *ngIf="earningsData?.operationalExpenses">
            <h4>ğŸ’¼ Operational Costs (Proportional)</h4>
            <p class="amount expense">{{ formatCurrency(earningsData?.operationalExpenses || 0) }}</p>
            <span class="subtext">Calculated for date range</span>
          </div>

          <div class="breakdown-card" *ngIf="earningsData?.platformCharges">
            <h4>ğŸ¦ Platform Charges (Proportional)</h4>
            <p class="amount expense">{{ formatCurrency(earningsData?.platformCharges || 0) }}</p>
            <span class="subtext">Zomato/Swiggy for date range</span>
          </div>

          <div class="breakdown-card">
            <h4>ğŸ“Š Total Expenses</h4>
            <p class="amount expense-total">{{ formatCurrency(earningsData?.totalExpenses || 0) }}</p>
          </div>
        </div>
      </div>

      <!-- Collections Summary -->
      <div class="insight-section">
        <h3>ğŸ’° Collections Summary</h3>
        <div class="collections-summary">
          <div class="collection-card">
            <h4>ğŸ’µ Cash Collection</h4>
            <p class="amount">{{ formatCurrency(earningsData?.totalCashCollection || 0) }}</p>
            <span class="subtext">From cash sales</span>
          </div>

          <div class="collection-card">
            <h4>ğŸ’³ Online Collection</h4>
            <p class="amount">{{ formatCurrency(earningsData?.totalOnlineCollection || 0) }}</p>
            <span class="subtext">From card/UPI/online</span>
          </div>

          <div class="collection-card">
            <h4>ğŸ“± Online Platform</h4>
            <p class="amount">{{ formatCurrency(earningsData?.onlinePlatformCollection || 0) }}</p>
            <span class="subtext">Zomato/Swiggy</span>
          </div>

          <div class="collection-card total">
            <h4>ğŸ“Š Total Collection</h4>
            <p class="amount total">{{ formatCurrency(earningsData?.totalCollection || 0) }}</p>
            <span class="subtext">All collections</span>
          </div>
        </div>
      </div>

      </div>

    </ng-container>
  </div>
  <!-- End Earnings Analytics Section -->

  <!-- Online Sales Analytics Section -->
  <div *ngIf="selectedAnalyticsTab === 'online'">
    <h2 class="section-title">ğŸ“± Online Sales Analytics</h2>

    <div *ngIf="onlineLoading" class="loading">
      <p>Loading online sales insights...</p>
    </div>

    <div *ngIf="!onlineLoading && !onlineAnalytics" class="empty-state">
      <p>No online sales data available for the selected date range</p>
    </div>

    <div *ngIf="!onlineLoading && onlineAnalytics" class="insights-container">

      <!-- Platform Tabs -->
      <div class="platform-tabs">
        <button class="platform-btn" [class.active]="selectedPlatform === 'All'" (click)="switchPlatform('All')">
          ğŸ“Š Combined Analytics
        </button>
        <button class="platform-btn zomato" [class.active]="selectedPlatform === 'Zomato'" (click)="switchPlatform('Zomato')">
          ğŸ” Zomato
        </button>
        <button class="platform-btn swiggy" [class.active]="selectedPlatform === 'Swiggy'" (click)="switchPlatform('Swiggy')">
          ğŸ• Swiggy
        </button>
      </div>

      <!-- Overall Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card">
          <div class="card-icon">ğŸ“¦</div>
          <div class="card-content">
            <h3>Total Orders</h3>
            <p class="card-value">{{ getActivePlatformData().totalOrders }}</p>
            <span class="card-subtext">Orders placed</span>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">ğŸ›’</div>
          <div class="card-content">
            <h3>Item Subtotal</h3>
            <p class="card-value">{{ formatCurrency(getActivePlatformData().itemSubtotal) }}</p>
            <span class="card-subtext">Before charges</span>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">ğŸ“¦</div>
          <div class="card-content">
            <h3>Packaging Charge</h3>
            <p class="card-value">{{ formatCurrency(getActivePlatformData().totalPackaging) }}</p>
            <span class="card-subtext">{{ getActivePlatformData().packagingUsagePercent.toFixed(1) }}% usage</span>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">ğŸ«</div>
          <div class="card-content">
            <h3>Total Discount</h3>
            <p class="card-value">{{ formatCurrency(getActivePlatformData().totalDiscount) }}</p>
            <span class="card-subtext">{{ getActivePlatformData().ordersWithDiscount }} orders</span>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">ğŸ“Š</div>
          <div class="card-content">
            <h3>Total Deduction</h3>
            <p class="card-value">{{ formatCurrency(getActivePlatformData().totalDeduction) }}</p>
            <span class="card-subtext">Platform commission</span>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">ğŸ¦</div>
          <div class="card-content">
            <h3>Total Monthly Charges</h3>
            <p class="card-value">{{ formatCurrency(getActivePlatformData().totalMonthlyCharges) }}</p>
            <span class="card-subtext">Platform fees</span>
          </div>
        </div>

        <div class="summary-card revenue">
          <div class="card-icon">ğŸ’°</div>
          <div class="card-content">
            <h3>Net Payout</h3>
            <p class="card-value">{{ formatCurrency(getActivePlatformData().totalIncome) }}</p>
            <span class="card-subtext">Actual earnings</span>
          </div>
        </div>

        <div class="summary-card rating">
          <div class="card-icon">â­</div>
          <div class="card-content">
            <h3>Average Rating</h3>
            <p class="card-value">{{ getActivePlatformData().avgRating.toFixed(1) }} â­</p>
            <span class="card-subtext">Customer satisfaction</span>
          </div>
        </div>
      </div>

      <!-- Platform Comparison (Only for 'All') -->
      <div *ngIf="selectedPlatform === 'All'" class="insight-section">
        <h2>âš–ï¸ Platform Comparison</h2>
        <div class="comparison-grid">
          <div class="comparison-card zomato-card">
            <h3>ğŸ” Zomato</h3>
            <div class="comparison-stats">
              <div class="stat-row">
                <span>Orders:</span>
                <strong>{{ onlineAnalytics.zomato.totalOrders }}</strong>
              </div>
              <div class="stat-row">
                <span>Income:</span>
                <strong>{{ formatCurrency(onlineAnalytics.zomato.totalIncome) }}</strong>
              </div>
              <div class="stat-row">
                <span>Avg/Order:</span>
                <strong>{{ formatCurrency(onlineAnalytics.zomato.avgIncomePerOrder) }}</strong>
              </div>
              <div class="stat-row">
                <span>Rating:</span>
                <strong>{{ onlineAnalytics.zomato.avgRating.toFixed(1) }} â­</strong>
              </div>
              <div class="stat-row">
                <span>Deduction %:</span>
                <strong>{{ onlineAnalytics.zomato.avgDeductionPercent.toFixed(1) }}%</strong>
              </div>
              <div class="stat-row">
                <span>Total Discount:</span>
                <strong>{{ formatCurrency(onlineAnalytics.zomato.totalDiscount) }}</strong>
              </div>
              <div class="stat-row">
                <span>Packaging:</span>
                <strong>{{ formatCurrency(onlineAnalytics.zomato.totalPackaging) }}</strong>
              </div>
            </div>
          </div>

          <div class="comparison-card swiggy-card">
            <h3>ğŸ• Swiggy</h3>
            <div class="comparison-stats">
              <div class="stat-row">
                <span>Orders:</span>
                <strong>{{ onlineAnalytics.swiggy.totalOrders }}</strong>
              </div>
              <div class="stat-row">
                <span>Income:</span>
                <strong>{{ formatCurrency(onlineAnalytics.swiggy.totalIncome) }}</strong>
              </div>
              <div class="stat-row">
                <span>Avg/Order:</span>
                <strong>{{ formatCurrency(onlineAnalytics.swiggy.avgIncomePerOrder) }}</strong>
              </div>
              <div class="stat-row">
                <span>Rating:</span>
                <strong>{{ onlineAnalytics.swiggy.avgRating.toFixed(1) }} â­</strong>
              </div>
              <div class="stat-row">
                <span>Deduction %:</span>
                <strong>{{ onlineAnalytics.swiggy.avgDeductionPercent.toFixed(1) }}%</strong>
              </div>
              <div class="stat-row">
                <span>Total Discount:</span>
                <strong>{{ formatCurrency(onlineAnalytics.swiggy.totalDiscount) }}</strong>
              </div>
              <div class="stat-row">
                <span>Packaging:</span>
                <strong>{{ formatCurrency(onlineAnalytics.swiggy.totalPackaging) }}</strong>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Items -->
      <div class="insight-section">
        <h2>ğŸ† Top Ordered Items</h2>
        <div class="top-items-grid">
          <div *ngFor="let item of getActivePlatformData().topItems; let i = index" class="top-item-card" [class.top-1]="i === 0" [class.top-2]="i === 1" [class.top-3]="i === 2">
            <div class="item-rank">{{ i + 1 }}</div>
            <div class="item-details">
              <h4>{{ item.name }}</h4>
              <p>Orders: {{ item.count }}</p>
              <p class="item-revenue">Quantity: {{ item.quantity }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Daily Trend -->
      <div class="insight-section">
        <h2>ğŸ“ˆ Daily Income Trend</h2>
        <div class="trend-chart">
          <div *ngFor="let day of getActivePlatformData().dailyTrend" class="trend-bar">
            <div class="bar-container">
              <div class="bar" [style.height.%]="(day.income / getActivePlatformData().maxDailyIncome) * 100"></div>
            </div>
            <div class="bar-label">{{ formatShortDate(day.date) }}</div>
            <div class="bar-value">{{ formatCurrency(day.income) }}</div>
            <div class="bar-orders">{{ day.orders }} orders</div>
          </div>
        </div>
      </div>

      <!-- Peak Days Analysis -->
      <div class="insight-section">
        <h2>â° Peak Days Analysis</h2>
        <div class="peak-hours-grid">
          <div *ngFor="let peak of getActivePlatformData().peakDays" class="peak-card">
            <div class="peak-day">{{ peak.dayName }}</div>
            <div class="peak-stats">
              <div>{{ peak.orders }} orders</div>
              <div class="peak-income">{{ formatCurrency(peak.income) }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Distance Analysis -->
      <div class="insight-section">
        <h2>ğŸš— Delivery Distance Analysis</h2>
        <div class="distance-stats">
          <div class="distance-card">
            <h4>Min Distance</h4>
            <p class="distance-value">{{ getActivePlatformData().minDistance.toFixed(1) }} km</p>
          </div>
          <div class="distance-card">
            <h4>Max Distance</h4>
            <p class="distance-value">{{ getActivePlatformData().maxDistance.toFixed(1) }} km</p>
          </div>
          <div class="distance-card">
            <h4>Avg Distance</h4>
            <p class="distance-value">{{ getActivePlatformData().avgDistance.toFixed(1) }} km</p>
          </div>
          <div class="distance-card">
            <h4>Most Common Range</h4>
            <p class="distance-value">{{ getActivePlatformData().commonDistanceRange }}</p>
          </div>
        </div>
      </div>

      <!-- Rating Distribution -->
      <div class="insight-section">
        <h2>â­ Rating Distribution</h2>
        <div class="rating-distribution">
          <div *ngFor="let rating of getActivePlatformData().ratingDistribution" class="rating-bar">
            <div class="rating-label">{{ rating.stars }} â­</div>
            <div class="rating-bar-container">
              <div class="rating-fill" [style.width.%]="rating.percentage"></div>
            </div>
            <div class="rating-count">{{ rating.count }} orders ({{ rating.percentage.toFixed(1) }}%)</div>
          </div>
        </div>
      </div>

      <!-- Monthly Comparison -->
      <div class="insight-section">
        <h2>ğŸ“Š Monthly Performance</h2>
        <div class="monthly-comparison">
          <div *ngFor="let month of getActivePlatformData().monthlyData" class="month-card">
            <h4>{{ month.month }}</h4>
            <div class="month-stats">
              <div class="stat">
                <span>Orders:</span>
                <strong>{{ month.orders }}</strong>
              </div>
              <div class="stat">
                <span>Income:</span>
                <strong>{{ formatCurrency(month.income) }}</strong>
              </div>
              <div class="stat">
                <span>Avg Rating:</span>
                <strong>{{ month.avgRating.toFixed(1) }} â­</strong>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>
